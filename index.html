<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Notus Labs API PoC (Problemas DX)</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>Notus Labs API PoC ‚Äì Testes com Problemas de DX</h1>
    <label>
      API Key:
      <input type="password" id="apiKey" placeholder="Insira sua API Key" />
    </label>
    <button onclick="saveApiKey()">Salvar</button>
  </header>

  <!-- Smart Wallets -->
  <section>
    <h2>üîπ Smart Wallets</h2>

    <!-- Problema #1, #7 -->
    <div class="test-card">
      <h3>GET /wallets/address (Problemas #1 e #7)</h3>
      <p><strong>‚ö†Ô∏è Problema:</strong> Ignora `address`; exige EOA + factory.</p>
      <input type="text" id="getAddress" placeholder="Endere√ßo da wallet (ex: 0x3437...)" value="0x34378c28a87ac84266211aa9b1c77caca241a659" />
      <input type="text" id="getEoa" placeholder="EOA (0x...)" value="0x96832a27567538a804dfb8493513d7199ac63944" />
      <input type="text" id="getFactory" placeholder="Factory" value="0x0000000000400CdFef5E2714E63d8040b700BC24" readonly />
      <button onclick="testWalletGet()">Executar</button>
      <pre id="result-wallet-get"></pre>
    </div>

    <!-- Problema #2, #3, #4 -->
    <div class="test-card">
      <h3>POST /wallets/register (Problemas #2, #3, #4)</h3>
      <p><strong>‚ö†Ô∏è Problemas:</strong> EOA inv√°lido ‚Üí "Invalid"; salt padr√£o = "0"; erro 403 sem API key.</p>
      <input type="text" id="eoaReg" placeholder="EOA (teste com '0xinvalido')" value="0x96832a27567538a804dfb8493513d7199ac63944" />
      <input type="text" id="factoryReg" placeholder="Factory" value="0x0000000000400CdFef5E2714E63d8040b700BC24" readonly />
      <input type="text" id="saltReg" placeholder="Salt (opcional ‚Äì padr√£o: '0')" />
      <button onclick="testWalletRegister()">Executar</button>
      <pre id="result-wallet-register"></pre>
    </div>

    <!-- Teste #9, #21 + Problema #5 -->
    <div class="test-card">
      <h3>GET /wallets/{address}/portfolio (Teste #9, #21 ‚Äì Problema #5)</h3>
      <p><strong>‚ö†Ô∏è Problema:</strong> Pode retornar `500` na 1¬™ chamada.</p>
      <input type="text" id="portfolioAddress" placeholder="Endere√ßo da wallet" value="0x34378c28a87ac84266211aa9b1c77caca241a659" />
      <button onclick="testPortfolio()">Executar</button>
      <pre id="result-portfolio"></pre>
    </div>

    <!-- Teste #10, #22 -->
    <div class="test-card">
      <h3>GET /wallets/{address}/history (Teste #10, #22)</h3>
      <input type="text" id="historyAddress" placeholder="Endere√ßo da wallet" value="0x34378c28a87ac84266211aa9b1c77caca241a659" />
      <button onclick="testHistory()">Executar</button>
      <pre id="result-history"></pre>
    </div>

    <!-- Teste #11 + Problema #6 -->
    <div class="test-card">
      <h3>POST /wallets/{address}/deposit (Teste #11 ‚Äì Problema #6)</h3>
      <p><strong>‚ö†Ô∏è Problema:</strong> Saldo insuficiente ‚Üí `500` (deveria ser `400`).</p>
      <input type="text" id="depositAddress" placeholder="Endere√ßo da wallet" value="0x34378c28a87ac84266211aa9b1c77caca241a659" />
      <input type="text" id="tokenAddr" placeholder="Token ERC-20 (USDC)" value="0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48" />
      <input type="number" id="depositAmount" placeholder="Amount (ex: 1000000)" value="1000000" />
      <input type="number" id="chainIdDep" placeholder="Chain ID" value="1" />
      <input type="text" id="fromAddr" placeholder="From Address (EOA)" value="0x96832a27567538a804dfb8493513d7199ac63944" />
      <button onclick="testDeposit()">Executar</button>
      <pre id="result-deposit"></pre>
    </div>

    <!-- Teste #12 + Problema #8 -->
    <div class="test-card">
      <h3>PATCH /wallets/{address}/metadata (Teste #12)</h3>
      <p><strong>‚úÖ Aceita:</strong> objeto JSON.</p>
      <input type="text" id="metaWalletAddr" placeholder="Endere√ßo da wallet" value="0x34378c28a87ac84266211aa9b1c77caca241a659" />
      <textarea id="walletMeta" placeholder='{"name":"Minha Wallet","tag":"test"}'>{"name":"Minha Wallet","tag":"test"}</textarea>
      <button onclick="testUpdateWalletMetadata()">Executar</button>
      <pre id="result-wallet-meta"></pre>
    </div>

    <!-- Teste #13 + Problema #8 -->
    <div class="test-card">
      <h3>PATCH /wallets/transactions/{id}/metadata (Teste #13 ‚Äì Problema #8)</h3>
      <p><strong>‚ö†Ô∏è Aceita apenas:</strong> string (n√£o objeto).</p>
      <input type="text" id="txIdMeta" placeholder="Transaction ID (ex: invalid-id)" value="invalid-id" />
      <input type="text" id="txMeta" placeholder="Metadata (string)" value="Test transaction for DX research" />
      <button onclick="testUpdateTxMetadata()">Executar</button>
      <pre id="result-tx-meta"></pre>
    </div>
  </section>

  <!-- KYC -->
  <section>
    <h2>üîπ KYC</h2>

    <!-- Teste #14 + Problema #9 -->
    <div class="test-card">
      <h3>POST /kyc/.../standard (Teste #14 ‚Äì Problema #9)</h3>
      <p><strong>‚ö†Ô∏è Problema:</strong> Documenta√ß√£o diz que campos s√£o opcionais, mas s√£o obrigat√≥rios.</p>
      <button onclick="testKycCreate()">Executar (com todos os campos)</button>
      <pre id="result-kyc-create"></pre>
    </div>

    <!-- Teste #18 -->
    <div class="test-card">
      <h3>POST /kyc/.../standard (Teste #18 ‚Äì Campos faltando)</h3>
      <button onclick="testKycCreateMinimal()">Executar (sem campos obrigat√≥rios)</button>
      <pre id="result-kyc-create-minimal"></pre>
    </div>

    <!-- Teste #15, #17 -->
    <div class="test-card">
      <h3>GET /kyc/.../{sessionId} (Teste #15, #17)</h3>
      <input type="text" id="kycSessionId" placeholder="Session ID (ex: a7fd2ad4-...)" />
      <button onclick="testKycGet()">Executar</button>
      <pre id="result-kyc-get"></pre>
    </div>

    <!-- Teste #16 -->
    <div class="test-card">
      <h3>POST /kyc/.../{sessionId}/process (Teste #16)</h3>
      <p><strong>‚ö†Ô∏è Observa√ß√£o:</strong> Retorna `204`, mas falha assincronamente se n√£o houver documentos.</p>
      <input type="text" id="kycProcessId" placeholder="Session ID" />
      <button onclick="testKycProcess()">Executar</button>
      <pre id="result-kyc-process"></pre>
    </div>

    <!-- Teste #19 -->
    <div class="test-card">
      <h3>GET /kyc/.../invalid-id (Teste #19)</h3>
      <button onclick="testKycNotFound()">Executar</button>
      <pre id="result-kyc-notfound"></pre>
    </div>
  </section>

  <!-- Fiat -->
  <section>
    <h2>üîπ Fiat</h2>

    <!-- Teste #20 -->
    <div class="test-card">
      <h3>POST /fiat/deposit/quote (Teste #20)</h3>
      <p><strong>‚ö†Ô∏è Comportamento esperado:</strong> `403` se KYC n√£o aprovado ou sem habilita√ß√£o.</p>
      <button onclick="testFiatQuote()">Executar</button>
      <pre id="result-fiat-quote"></pre>
    </div>
  </section>

  <script src="script.js"></script>
</body>
</html>